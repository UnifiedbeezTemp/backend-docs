"use strict";(globalThis.webpackChunkbackend_docs=globalThis.webpackChunkbackend_docs||[]).push([[1502],{6187:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"apple-integration","title":"Apple Sign In Integration Guide","description":"Overview","source":"@site/docs/apple-integration.md","sourceDirName":".","slug":"/apple-integration","permalink":"/backend-docs/docs/apple-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/apple-integration.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udd10 Two-Factor Authentication (2FA) \u2013 Frontend Integration Guide","permalink":"/backend-docs/docs/2fa-auth-integration"},"next":{"title":"Addon System - Frontend Integration Guide","permalink":"/backend-docs/docs/addon-integration"}}');var r=i(4848),a=i(8453);const s={sidebar_position:5},o="Apple Sign In Integration Guide",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Frontend Implementation",id:"frontend-implementation",level:2},{value:"1. Install Apple JS SDK",id:"1-install-apple-js-sdk",level:3},{value:"2. Configuration",id:"2-configuration",level:3},{value:"3. Sign In Component",id:"3-sign-in-component",level:3},{value:"4. Callback Handler Page",id:"4-callback-handler-page",level:3},{value:"5. Usage",id:"5-usage",level:3},{value:"Flow Diagram",id:"flow-diagram",level:2},{value:"Session Management",id:"session-management",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Apple Developer Console Setup",id:"apple-developer-console-setup",level:2},{value:"Notes",id:"notes",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"apple-sign-in-integration-guide",children:"Apple Sign In Integration Guide"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Apple Sign In uses OAuth2 authorization code flow with server-side token exchange."}),"\n",(0,r.jsx)(n.h2,{id:"frontend-implementation",children:"Frontend Implementation"}),"\n",(0,r.jsx)(n.h3,{id:"1-install-apple-js-sdk",children:"1. Install Apple JS SDK"}),"\n",(0,r.jsxs)(n.p,{children:["Add to your HTML ",(0,r.jsx)(n.code,{children:"<head>"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-html",children:'<script\n  type="text/javascript"\n  src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"\n><\/script>\n'})}),"\n",(0,r.jsx)(n.h3,{id:"2-configuration",children:"2. Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// config/appleAuth.ts\nexport const appleAuthConfig = {\n  clientId: import.meta.env.VITE_APPLE_CLIENT_ID,\n  redirectURI: import.meta.env.VITE_APPLE_REDIRECT_URI, // Backend callback URL\n  scope: "name email",\n};\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Environment Variables:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"VITE_APPLE_CLIENT_ID=com.yourcompany.yourapp.service\nVITE_APPLE_REDIRECT_URI=https://yourdomain.com/api/v1/auth/apple/callback\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-sign-in-component",children:"3. Sign In Component"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import React, { useEffect } from "react";\nimport { appleAuthConfig } from "../config/appleAuth";\n\ninterface AppleAuthProps {\n  mode: "signup" | "login";\n}\n\ndeclare global {\n  interface Window {\n    AppleID: any;\n  }\n}\n\nexport const AppleAuth: React.FC<AppleAuthProps> = ({ mode }) => {\n  useEffect(() => {\n    const script = document.createElement("script");\n    script.src =\n      "https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js";\n    script.async = true;\n    script.onload = () => {\n      if (window.AppleID) {\n        window.AppleID.auth.init({\n          clientId: appleAuthConfig.clientId,\n          scope: appleAuthConfig.scope,\n          redirectURI: appleAuthConfig.redirectURI,\n          state: mode, // Pass signup/login mode\n          usePopup: false, // Use redirect flow\n        });\n      }\n    };\n    document.head.appendChild(script);\n\n    return () => {\n      if (document.head.contains(script)) {\n        document.head.removeChild(script);\n      }\n    };\n  }, [mode]);\n\n  const handleAppleAuth = async () => {\n    try {\n      if (!window.AppleID) {\n        throw new Error("Apple ID SDK not loaded");\n      }\n\n      // Redirects to Apple, then back to redirectURI\n      await window.AppleID.auth.signIn();\n    } catch (error) {\n      console.error("Apple auth error:", error);\n    }\n  };\n\n  return (\n    <button\n      onClick={handleAppleAuth}\n      className="apple-auth-btn"\n      style={{\n        backgroundColor: "#000",\n        color: "white",\n        border: "none",\n        padding: "12px 24px",\n        borderRadius: "4px",\n        cursor: "pointer",\n        fontSize: "14px",\n        fontWeight: "600",\n        width: "100%",\n      }}\n    >\n      {mode === "signup" ? "Sign up" : "Sign in"} with Apple\n    </button>\n  );\n};\n'})}),"\n",(0,r.jsx)(n.h3,{id:"4-callback-handler-page",children:"4. Callback Handler Page"}),"\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"/auth/callback"})," route:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// pages/AuthCallback.tsx\nimport React, { useEffect } from "react";\nimport { useNavigate, useSearchParams } from "react-router-dom";\n\nexport const AuthCallback: React.FC = () => {\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n\n  useEffect(() => {\n    const success = searchParams.get("success");\n    const error = searchParams.get("error");\n\n    if (success) {\n      // Auth successful, session cookie set by backend\n      navigate("/dashboard");\n    } else if (error) {\n      // Show error message\n      console.error("Auth error:", error);\n      navigate("/login?error=" + encodeURIComponent(error));\n    }\n  }, [searchParams, navigate]);\n\n  return (\n    <div style={{ textAlign: "center", marginTop: "50px" }}>\n      <p>Processing authentication...</p>\n    </div>\n  );\n};\n'})}),"\n",(0,r.jsx)(n.h3,{id:"5-usage",children:"5. Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'// In your login/signup page\nimport { AppleAuth } from "../components/AppleAuth";\n\nfunction LoginPage() {\n  return (\n    <div>\n      <h1>Login</h1>\n      <AppleAuth mode="login" />\n    </div>\n  );\n}\n\nfunction SignupPage() {\n  return (\n    <div>\n      <h1>Sign Up</h1>\n      <AppleAuth mode="signup" />\n    </div>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"flow-diagram",children:"Flow Diagram"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'1. User clicks "Sign in with Apple"\n   \u2193\n2. Frontend calls AppleID.auth.signIn()\n   \u2193\n3. Redirects to Apple\'s auth page\n   \u2193\n4. User authenticates with Apple\n   \u2193\n5. Apple redirects to backend: POST /api/v1/auth/apple/callback\n   \u2193\n6. Backend exchanges code for tokens, creates session\n   \u2193\n7. Backend redirects to: /auth/callback?success=true\n   \u2193\n8. Frontend callback page handles success/error\n   \u2193\n9. Navigate to dashboard (session cookie already set)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"session-management",children:"Session Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Session is managed via ",(0,r.jsx)(n.strong,{children:"httpOnly cookie"})," (set by backend)"]}),"\n",(0,r.jsx)(n.li,{children:"No need to handle tokens in frontend"}),"\n",(0,r.jsx)(n.li,{children:"Cookie is automatically sent with API requests"}),"\n",(0,r.jsxs)(n.li,{children:["Cookie settings: ",(0,r.jsx)(n.code,{children:"httpOnly"}),", ",(0,r.jsx)(n.code,{children:"secure"}),", ",(0,r.jsx)(n.code,{children:"sameSite=none"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"Backend redirects to callback with error query param:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/auth/callback?error=Authentication%20failed\n"})}),"\n",(0,r.jsx)(n.p,{children:"Handle in callback page and show appropriate message to user."}),"\n",(0,r.jsx)(n.h2,{id:"apple-developer-console-setup",children:"Apple Developer Console Setup"}),"\n",(0,r.jsx)(n.p,{children:"Required configuration:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"App ID"})," - Enable Sign in with Apple capability"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Services ID"})," - Create with your client ID"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Return URLs"})," - Add backend callback URL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Domain verification"})," - Verify your domain"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Private Key"})," - Create for token signing (backend uses this)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"First-time users: Apple returns user name in response"}),"\n",(0,r.jsx)(n.li,{children:"Subsequent logins: Only email in ID token"}),"\n",(0,r.jsx)(n.li,{children:"Backend persists user info on first signup"}),"\n",(0,r.jsx)(n.li,{children:"State parameter differentiates signup vs login"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var t=i(6540);const r={},a=t.createContext(r);function s(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);