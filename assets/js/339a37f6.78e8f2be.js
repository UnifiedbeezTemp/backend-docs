"use strict";(globalThis.webpackChunkbackend_docs=globalThis.webpackChunkbackend_docs||[]).push([[5693],{8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>l});var i=s(6540);const t={},o=i.createContext(t);function r(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:n},e.children)}},9537:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"channels-integration/email-channels-integration-mobile","title":"Email OAuth Integration Guide for React Native","description":"Overview","source":"@site/docs/channels-integration/email-channels-integration-mobile.md","sourceDirName":"channels-integration","slug":"/channels-integration/email-channels-integration-mobile","permalink":"/backend-docs/docs/channels-integration/email-channels-integration-mobile","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/channels-integration/email-channels-integration-mobile.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Automation Categories \u2014 Frontend Integration Guide","permalink":"/backend-docs/docs/campaign-templates"},"next":{"title":"Custom Email (AWS SES) Integration Guide","permalink":"/backend-docs/docs/channels-integration/custom-email-integration"}}');var t=s(4848),o=s(8453);const r={sidebar_position:1},l="Email OAuth Integration Guide for React Native",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Required Headers",id:"required-headers",level:3},{value:"Dependencies",id:"dependencies",level:3},{value:"Backend Environment Variables",id:"backend-environment-variables",level:3},{value:"Authentication Flow",id:"authentication-flow",level:2},{value:"High-Level Steps",id:"high-level-steps",level:3},{value:"Gmail Integration",id:"gmail-integration",level:2},{value:"Step 1: OAuth Configuration",id:"step-1-oauth-configuration",level:3},{value:"Step 2: Get Authorization Code",id:"step-2-get-authorization-code",level:3},{value:"Step 3: Connect Gmail",id:"step-3-connect-gmail",level:3},{value:"Outlook Integration",id:"outlook-integration",level:2},{value:"Step 1: OAuth Configuration",id:"step-1-oauth-configuration-1",level:3},{value:"Step 2: Get Tokens",id:"step-2-get-tokens",level:3},{value:"Step 3: Connect Outlook",id:"step-3-connect-outlook",level:3},{value:"Enable Sending Permissions",id:"enable-sending-permissions",level:2},{value:"Gmail - Enable Sending",id:"gmail---enable-sending",level:3},{value:"Outlook - Enable Sending",id:"outlook---enable-sending",level:3},{value:"Response Formats",id:"response-formats",level:2},{value:"Successful Connection Response",id:"successful-connection-response",level:3},{value:"Error Response",id:"error-response",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Common Error Codes",id:"common-error-codes",level:3},{value:"OAuth Flow Errors",id:"oauth-flow-errors",level:3},{value:"Flow Diagrams",id:"flow-diagrams",level:2},{value:"Gmail Connection Flow",id:"gmail-connection-flow",level:3},{value:"Outlook Connection Flow",id:"outlook-connection-flow",level:3},{value:"Key Differences: Gmail vs Outlook",id:"key-differences-gmail-vs-outlook",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Testing Checklist",id:"testing-checklist",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"email-oauth-integration-guide-for-react-native",children:"Email OAuth Integration Guide for React Native"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"This guide covers integrating Gmail and Outlook OAuth authentication in React Native applications. The backend supports both iOS and Android platforms with platform-specific OAuth configurations."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#prerequisites",children:"Prerequisites"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#authentication-flow",children:"Authentication Flow"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#gmail-integration",children:"Gmail Integration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#outlook-integration",children:"Outlook Integration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#enable-sending-permissions",children:"Enable Sending Permissions"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#response-formats",children:"Response Formats"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#error-handling",children:"Error Handling"})}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.h3,{id:"required-headers",children:"Required Headers"}),"\n",(0,t.jsx)(n.p,{children:"All mobile API requests must include:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Authorization: Bearer {userAccessToken}\nContent-Type: application/json\nx-client-type: mobile\nx-platform: ios | android\n"})}),"\n",(0,t.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install react-native-app-auth\n"})}),"\n",(0,t.jsx)(n.h3,{id:"backend-environment-variables",children:"Backend Environment Variables"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Google - iOS/Android\nGOOGLE_CLIENT_ID_IOS=\nGOOGLE_IOS_REDIRECT_URI=\nGOOGLE_CLIENT_ID_ANDROID=\nGOOGLE_CLIENT_SECRET_ANDROID=\nGOOGLE_ANDROID_REDIRECT_URI=\n\n# Microsoft - iOS/Android\nMICROSOFT_CLIENT_ID_IOS=\nMICROSOFT_CLIENT_SECRET_IOS=\nMICROSOFT_IOS_REDIRECT_URI=\nMICROSOFT_CLIENT_ID_ANDROID=\nMICROSOFT_CLIENT_SECRET_ANDROID=\nMICROSOFT_ANDROID_REDIRECT_URI=\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"authentication-flow",children:"Authentication Flow"}),"\n",(0,t.jsx)(n.h3,{id:"high-level-steps",children:"High-Level Steps"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mobile App"}),": Initiate OAuth flow using ",(0,t.jsx)(n.code,{children:"react-native-app-auth"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"OAuth Provider"}),": User authenticates and grants permissions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mobile App"}),": Receives authorization code or tokens"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mobile App"}),": Sends code/tokens to backend with mobile headers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Backend"}),": Exchanges code for tokens (if needed) and stores credentials"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Backend"}),": Returns connection details"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"gmail-integration",children:"Gmail Integration"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-oauth-configuration",children:"Step 1: OAuth Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"{\n  issuer: 'https://accounts.google.com',\n  clientId: Platform.OS === 'ios' ? 'IOS_CLIENT_ID' : 'ANDROID_CLIENT_ID',\n  redirectUrl: 'your-app-scheme:/oauth2redirect/google',\n  scopes: [\n    'https://www.googleapis.com/auth/gmail.readonly',\n    'https://www.googleapis.com/auth/gmail.send', // optional\n    'https://www.googleapis.com/auth/userinfo.email',\n  ],\n  additionalParameters: {\n    access_type: 'offline',\n    prompt: 'consent',\n  },\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-get-authorization-code",children:"Step 2: Get Authorization Code"}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"react-native-app-auth"})," to get the authorization code from the OAuth flow."]}),"\n",(0,t.jsx)(n.h3,{id:"step-3-connect-gmail",children:"Step 3: Connect Gmail"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Route:"})," ",(0,t.jsx)(n.code,{children:"POST /channels/email/google/connect"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Headers:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Authorization: Bearer {userAccessToken}\nContent-Type: application/json\nx-client-type: mobile\nx-platform: ios | android\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Payload:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "authCode": "authorization_code_from_oauth",\n  "channelId": 123 // optional: existing channel ID\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "message": "Gmail connected successfully",\n  "connectedChannelId": 456,\n  "emailAccountId": 789,\n  "email": "user@gmail.com",\n  "name": "John Doe",\n  "displayName": "John Doe",\n  "provider": "gmail",\n  "scopes": [\n    "https://www.googleapis.com/auth/gmail.readonly",\n    "https://www.googleapis.com/auth/gmail.send"\n  ],\n  "expiresAt": "2025-12-17T12:00:00.000Z",\n  "canSend": true,\n  "canReceive": true\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"outlook-integration",children:"Outlook Integration"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-oauth-configuration-1",children:"Step 1: OAuth Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"{\n  issuer: 'https://login.microsoftonline.com/common/v2.0',\n  clientId: Platform.OS === 'ios' ? 'IOS_CLIENT_ID' : 'ANDROID_CLIENT_ID',\n  redirectUrl: Platform.OS === 'ios'\n    ? 'msauth.com.yourapp://auth'\n    : 'msauth://com.yourapp/signature_hash',\n  scopes: [\n    'offline_access',\n    'User.Read',\n    'Mail.Read',\n    'Mail.Send', // optional\n  ],\n  additionalParameters: {\n    prompt: 'consent',\n  },\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-get-tokens",children:"Step 2: Get Tokens"}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.code,{children:"react-native-app-auth"})," to get access and refresh tokens from the OAuth flow."]}),"\n",(0,t.jsx)(n.h3,{id:"step-3-connect-outlook",children:"Step 3: Connect Outlook"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Route:"})," ",(0,t.jsx)(n.code,{children:"POST /channels/email/microsoft/connect"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Headers:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Authorization: Bearer {userAccessToken}\nContent-Type: application/json\nx-client-type: mobile\nx-platform: ios | android\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Payload Option 1 (Recommended for Mobile):"})}),"\n",(0,t.jsx)(n.p,{children:"Send tokens directly as JSON string:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "authCode": "{\\"access_token\\":\\"token\\",\\"refresh_token\\":\\"token\\",\\"expires_in\\":3600,\\"scope\\":\\"Mail.Read Mail.Send\\"}",\n  "channelId": 123 // optional\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Payload Option 2:"})}),"\n",(0,t.jsx)(n.p,{children:"Send authorization code:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "authCode": "authorization_code_from_oauth",\n  "channelId": 123 // optional\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "message": "Outlook connected successfully",\n  "connectedChannelId": 456,\n  "emailAccountId": 789,\n  "email": "user@outlook.com",\n  "name": "Jane Smith",\n  "displayName": "Jane Smith",\n  "provider": "outlook",\n  "scopes": ["offline_access", "User.Read", "Mail.Read", "Mail.Send"],\n  "expiresAt": "2025-12-17T12:00:00.000Z",\n  "canSend": true,\n  "canReceive": true\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"enable-sending-permissions",children:"Enable Sending Permissions"}),"\n",(0,t.jsx)(n.p,{children:"If an email account was initially connected with read-only permissions, you can upgrade to include sending permissions."}),"\n",(0,t.jsx)(n.h3,{id:"gmail---enable-sending",children:"Gmail - Enable Sending"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Route:"})," ",(0,t.jsx)(n.code,{children:"POST /channels/email/enable-sending/google"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Headers:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Authorization: Bearer {userAccessToken}\nContent-Type: application/json\nx-client-type: mobile\nx-platform: ios | android\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Payload:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "emailAccountId": 789,\n  "authCode": "new_authorization_code_with_send_scope"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"OAuth Scopes Required:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"https://www.googleapis.com/auth/gmail.send\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "emailAccountId": 789,\n  "canSend": true\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"outlook---enable-sending",children:"Outlook - Enable Sending"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Route:"})," ",(0,t.jsx)(n.code,{children:"POST /channels/email/enable-sending/microsoft"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Headers:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Authorization: Bearer {userAccessToken}\nContent-Type: application/json\nx-client-type: mobile\nx-platform: ios | android\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Payload:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "emailAccountId": 789,\n  "authCode": "new_authorization_code_with_send_scope"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"OAuth Scopes Required:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Mail.Send\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Response:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "success": true,\n  "emailAccountId": 789,\n  "canSend": true\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"response-formats",children:"Response Formats"}),"\n",(0,t.jsx)(n.h3,{id:"successful-connection-response",children:"Successful Connection Response"}),"\n",(0,t.jsx)(n.p,{children:"Both Gmail and Outlook return the same structure:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"{\n  success: boolean;\n  message: string;\n  connectedChannelId: number;\n  emailAccountId: number;\n  email: string;\n  name: string;\n  displayName: string;\n  provider: 'gmail' | 'outlook';\n  scopes: string[];\n  expiresAt: string; // ISO 8601 format\n  canSend: boolean;\n  canReceive: boolean;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"error-response",children:"Error Response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "statusCode": 400,\n  "message": "Failed to connect Gmail",\n  "error": "Bad Request"\n}\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.h3,{id:"common-error-codes",children:"Common Error Codes"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Status Code"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Action"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"400"}),(0,t.jsx)(n.td,{children:"Invalid auth code or missing tokens"}),(0,t.jsx)(n.td,{children:"Re-initiate OAuth flow"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"401"}),(0,t.jsx)(n.td,{children:"Unauthorized - invalid user token"}),(0,t.jsx)(n.td,{children:"Re-authenticate user"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"404"}),(0,t.jsx)(n.td,{children:"Email account not found"}),(0,t.jsx)(n.td,{children:"Check emailAccountId"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"500"}),(0,t.jsx)(n.td,{children:"Server error"}),(0,t.jsx)(n.td,{children:"Retry or contact support"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"oauth-flow-errors",children:"OAuth Flow Errors"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Error"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Action"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"user_cancelled"})}),(0,t.jsx)(n.td,{children:"User cancelled OAuth"}),(0,t.jsx)(n.td,{children:"Allow retry"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"authentication_failed"})}),(0,t.jsx)(n.td,{children:"OAuth authentication failed"}),(0,t.jsx)(n.td,{children:"Show error, allow retry"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsxs)(n.td,{children:["Missing ",(0,t.jsx)(n.code,{children:"refresh_token"})]}),(0,t.jsx)(n.td,{children:"Google didn't return refresh token"}),(0,t.jsxs)(n.td,{children:["Use ",(0,t.jsx)(n.code,{children:"prompt: 'consent'"})]})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"flow-diagrams",children:"Flow Diagrams"}),"\n",(0,t.jsx)(n.h3,{id:"gmail-connection-flow",children:"Gmail Connection Flow"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'1. App calls react-native-app-auth.authorize()\n   \u2193\n2. User authenticates with Google\n   \u2193\n3. App receives authorizationCode\n   \u2193\n4. App sends POST /channels/email/google/connect\n   Headers: x-client-type: mobile, x-platform: ios/android\n   Body: { authCode: "code" }\n   \u2193\n5. Backend:\n   - Determines platform from headers\n   - Uses iOS/Android client credentials\n   - Exchanges code for tokens\n   - Stores encrypted tokens in database\n   - Creates ConnectedChannel + EmailAccount\n   \u2193\n6. Backend returns connection details\n   \u2193\n7. App stores emailAccountId for future use\n'})}),"\n",(0,t.jsx)(n.h3,{id:"outlook-connection-flow",children:"Outlook Connection Flow"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'1. App calls react-native-app-auth.authorize()\n   \u2193\n2. User authenticates with Microsoft\n   \u2193\n3. App receives accessToken + refreshToken\n   \u2193\n4. App formats tokens as JSON string\n   \u2193\n5. App sends POST /channels/email/microsoft/connect\n   Headers: x-client-type: mobile, x-platform: ios/android\n   Body: { authCode: "{tokens_json}" }\n   \u2193\n6. Backend:\n   - Detects JSON format (starts with "{")\n   - Extracts tokens directly (no exchange needed)\n   - OR exchanges auth code if format is not JSON\n   - Stores encrypted tokens in database\n   - Creates ConnectedChannel + EmailAccount\n   \u2193\n7. Backend returns connection details\n   \u2193\n8. App stores emailAccountId for future use\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"key-differences-gmail-vs-outlook",children:"Key Differences: Gmail vs Outlook"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Aspect"}),(0,t.jsx)(n.th,{children:"Gmail"}),(0,t.jsx)(n.th,{children:"Outlook"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Auth Code Format"})}),(0,t.jsx)(n.td,{children:"String code"}),(0,t.jsx)(n.td,{children:"String code OR JSON tokens"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Client Secret"})}),(0,t.jsx)(n.td,{children:"Optional for mobile"}),(0,t.jsx)(n.td,{children:"Optional for mobile"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Token Exchange"})}),(0,t.jsx)(n.td,{children:"Always on backend"}),(0,t.jsx)(n.td,{children:"Optional (can send tokens directly)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Scopes Format"})}),(0,t.jsx)(n.td,{children:"URLs"}),(0,t.jsx)(n.td,{children:"Simple names"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Send Scope"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"gmail.send"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"Mail.Send"})})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Always include mobile headers"})," (",(0,t.jsx)(n.code,{children:"x-client-type"}),", ",(0,t.jsx)(n.code,{children:"x-platform"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Store ",(0,t.jsx)(n.code,{children:"emailAccountId"})]})," for future operations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Check ",(0,t.jsx)(n.code,{children:"canSend"})]})," before attempting to send emails"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle token expiration"})," by checking ",(0,t.jsx)(n.code,{children:"expiresAt"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:["Use ",(0,t.jsx)(n.code,{children:"prompt: 'consent'"})]})," to ensure refresh tokens"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Request minimal scopes"})," initially, upgrade later if needed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate responses"})," before storing connection details"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","iOS Gmail connection"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Android Gmail connection"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","iOS Outlook connection"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Android Outlook connection"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Gmail send permission upgrade"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Outlook send permission upgrade"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Error handling for cancelled flows"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Error handling for invalid tokens"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Token expiration detection"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Reconnection flow"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);