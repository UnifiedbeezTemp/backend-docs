"use strict";(globalThis.webpackChunkbackend_docs=globalThis.webpackChunkbackend_docs||[]).push([[6726],{3748:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"addon-integration","title":"Addon System - Frontend Integration Guide","description":"Core Concepts","source":"@site/docs/addon-integration.md","sourceDirName":".","slug":"/addon-integration","permalink":"/backend-docs/docs/addon-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/addon-integration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udd10 Two-Factor Authentication (2FA) \u2013 Frontend Integration Guide","permalink":"/backend-docs/docs/2fa-auth-integration"},"next":{"title":"Apple Sign In Integration Guide","permalink":"/backend-docs/docs/apple-integration"}}');var a=i(4848),s=i(8453);const d={},r="Addon System - Frontend Integration Guide",c={},t=[{value:"Core Concepts",id:"core-concepts",level:2},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Get Available Addons",id:"get-available-addons",level:3},{value:"Purchase Addon",id:"purchase-addon",level:3},{value:"Get Purchased Addons",id:"get-purchased-addons",level:3},{value:"Cancel Addon",id:"cancel-addon",level:3},{value:"Immediate Cancel (Admin)",id:"immediate-cancel-admin",level:3},{value:"Batch Purchase",id:"batch-purchase",level:3},{value:"Check Free Allowance",id:"check-free-allowance",level:3},{value:"Language-Specific Endpoints",id:"language-specific-endpoints",level:3},{value:"Response Fields",id:"response-fields",level:2},{value:"Displaying Addon Prices",id:"displaying-addon-prices",level:2},{value:"Validation Rules",id:"validation-rules",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"UI Patterns",id:"ui-patterns",level:2},{value:"Display Purchased Addons",id:"display-purchased-addons",level:3},{value:"Show Billing Info on Purchased Addon",id:"show-billing-info-on-purchased-addon",level:3},{value:"MULTI_LANGUAGE_AI Instance List",id:"multi_language_ai-instance-list",level:3},{value:"Purchase Flow",id:"purchase-flow",level:3},{value:"Quantity Limits",id:"quantity-limits",level:3},{value:"State Management",id:"state-management",level:2},{value:"Plan Integration",id:"plan-integration",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"addon-system---frontend-integration-guide",children:"Addon System - Frontend Integration Guide"})}),"\n",(0,a.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Addon Types:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Quantifiable"}),": EXTRA_SEAT, EXTRA_AI_ASSISTANT, TWILIO_MESSAGE_PACK (have quantities)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Feature"}),": CRM_CALENDAR_SYNC, ECOMMERCE_PACK (binary - you have it or don't)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Special"}),": MULTI_LANGUAGE_AI (one instance per language)"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Addon States:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"active"}),": Currently usable"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"scheduledForCancellation"}),": Active until ",(0,a.jsx)(n.code,{children:"expiresAt"}),", then deactivates"]}),"\n",(0,a.jsxs)(n.li,{children:["Plan limits apply to ",(0,a.jsx)(n.code,{children:"active"})," count only"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Billing Type vs Billing Interval:"})}),"\n",(0,a.jsx)(n.p,{children:"These are two distinct fields returned on purchased addons:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"billingType"})})," \u2014 the addon's pricing model. Values: ",(0,a.jsx)(n.code,{children:'"RECURRING"'})," (subscription-based, renews each cycle) or ",(0,a.jsx)(n.code,{children:'"PER_USAGE"'})," (one-time/usage charge). This is a static property of the addon definition."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.code,{children:"billingInterval"})})," \u2014 how often the recurring billing renews. Values: ",(0,a.jsx)(n.code,{children:'"MONTHLY"'})," or ",(0,a.jsx)(n.code,{children:'"YEARLY"'}),". This is recorded at purchase time from the user's active Stripe subscription and stored on the addon record."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ts",children:'type AddonBillingType = "RECURRING" | "PER_USAGE";\ntype BillingInterval = "MONTHLY" | "YEARLY";\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Addons inherit the billing interval of the user's ",(0,a.jsx)(n.strong,{children:"active Stripe subscription"})," at the time of purchase \u2014 there is no per-addon interval selection. A user on a yearly subscription is billed yearly for all addons (monthly price \xd7 12, charged upfront). A user on a monthly subscription is billed monthly."]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Note:"})," The addon ",(0,a.jsx)(n.code,{children:"billingInterval"})," is stored at purchase time from the actual Stripe subscription, not derived from ",(0,a.jsx)(n.code,{children:"user.planBillingInterval"}),". These can temporarily differ when a monthly \u2192 yearly switch is scheduled but not yet applied (the switch takes effect at the end of the current monthly period). During that window, addon purchases use monthly pricing to match the live subscription."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"GET /addon/available"})," response includes a top-level ",(0,a.jsx)(n.code,{children:"billingInterval"})," field and per-addon ",(0,a.jsx)(n.code,{children:"effectivePriceEur"})," \u2014 use these directly rather than reading from the user profile separately."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,a.jsx)(n.h3,{id:"get-available-addons",children:"Get Available Addons"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:"GET /addon/available\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "billingInterval": "YEARLY",\n  "addons": [\n    {\n      "id": 1,\n      "type": "EXTRA_SEAT",\n      "name": "Extra Seat",\n      "priceEur": 700,\n      "yearlyPriceEur": 8400,\n      "effectivePriceEur": 8400,\n      "currentQuantity": 3,\n      "basePlanAllowance": 5,\n      "maxAllowed": 10,\n      "remainingPurchasable": 2,\n      "isIncludedInPlan": false\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Price fields:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"priceEur"})," \u2014 monthly base price in pence, always present (700 = \xa37.00/month)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"yearlyPriceEur"})," \u2014 always ",(0,a.jsx)(n.code,{children:"priceEur \xd7 12"}),", present regardless of billing interval, useful for comparison UIs"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"effectivePriceEur"})," \u2014 the amount that will actually be charged: equals ",(0,a.jsx)(n.code,{children:"yearlyPriceEur"})," on yearly plans, ",(0,a.jsx)(n.code,{children:"priceEur"})," on monthly plans. ",(0,a.jsx)(n.strong,{children:"Use this as the primary display price."})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"billingInterval"})," \u2014 top-level field reflecting the user's current billing interval; use this to label prices and drive UI state without a separate profile call"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"purchase-addon",children:"Purchase Addon"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:'POST /addon/purchase\n\n{\n  "addonType": "EXTRA_SEAT",\n  "quantity": 2\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["The backend automatically determines the billing interval from the user's ",(0,a.jsx)(n.strong,{children:"active Stripe subscription"})," (not ",(0,a.jsx)(n.code,{children:"user.planBillingInterval"}),") and uses it to select the Stripe price and set the addon expiry (30 days for monthly, 365 days for yearly). No ",(0,a.jsx)(n.code,{children:"billingInterval"})," field is needed in the request."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"MULTI_LANGUAGE_AI requires pre-selection:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:'# 1. Select languages first\nPATCH /addon/multi-language/preferences\n{ "languages": ["spanish", "french"] }\n\n# 2. Purchase matching quantity\nPOST /addon/purchase\n{ "addonType": "MULTI_LANGUAGE_AI", "quantity": 2 }\n'})}),"\n",(0,a.jsx)(n.h3,{id:"get-purchased-addons",children:"Get Purchased Addons"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:"GET /addon/purchased\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Response:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "addons": [\n    {\n      "type": "EXTRA_SEAT",\n      "name": "Extra Seat",\n      "description": "Add one additional team member seat",\n      "priceEur": 700,\n      "billingType": "RECURRING",\n      "billingInterval": "MONTHLY",\n      "quantity": 5,\n      "active": 3,\n      "scheduledForCancellation": 2,\n      "isActive": true\n    },\n    {\n      "type": "MULTI_LANGUAGE_AI",\n      "name": "Multi-Language AI",\n      "description": "AI support for additional languages",\n      "priceEur": 1000,\n      "billingType": "RECURRING",\n      "billingInterval": "MONTHLY",\n      "quantity": 3,\n      "active": 2,\n      "scheduledForCancellation": 1,\n      "isActive": true,\n      "instances": [\n        {\n          "id": 4,\n          "language": "spanish",\n          "billingInterval": "MONTHLY",\n          "purchasedAt": "2026-02-27T09:32:12.022Z",\n          "expiresAt": "2026-03-29T09:32:10.503Z",\n          "scheduledForCancellation": false\n        },\n        {\n          "id": 6,\n          "language": "french",\n          "billingInterval": "MONTHLY",\n          "purchasedAt": "2026-02-27T09:32:12.028Z",\n          "expiresAt": "2026-03-29T09:32:10.503Z",\n          "scheduledForCancellation": true\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsxs)(n.strong,{children:["Note on ",(0,a.jsx)(n.code,{children:"billingInterval"}),":"]})," The top-level ",(0,a.jsx)(n.code,{children:"billingInterval"})," reflects the actual interval stored on the addon records at purchase time \u2014 not the user's current plan interval. If a user purchases addons while on a monthly subscription, ",(0,a.jsx)(n.code,{children:"billingInterval"})," will be ",(0,a.jsx)(n.code,{children:'"MONTHLY"'})," even if they later upgrade to a yearly plan. MULTI_LANGUAGE_AI instances also expose ",(0,a.jsx)(n.code,{children:"billingInterval"})," individually."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cancel-addon",children:"Cancel Addon"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:'# For MULTI_LANGUAGE_AI (specific instance)\nDELETE /addon/cancel/MULTI_LANGUAGE_AI\n{ "userAddonId": 4 }\n\n# For other addons (by quantity)\nDELETE /addon/cancel/EXTRA_SEAT\n{ "quantity": 2 }\n\n# Cancel all\nDELETE /addon/cancel/EXTRA_SEAT\n'})}),"\n",(0,a.jsx)(n.h3,{id:"immediate-cancel-admin",children:"Immediate Cancel (Admin)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:'DELETE /addon/cancel-immediate/EXTRA_SEAT\n{ "quantity": 1 }\n'})}),"\n",(0,a.jsx)(n.p,{children:"Returns a prorated refund amount. The refund calculation is billing-interval-aware:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Monthly: prorated over 30 days"}),"\n",(0,a.jsx)(n.li,{children:"Yearly: prorated over 365 days"}),"\n"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Refund behaviour:"})," The refund is issued against the most recent one-time purchase charge for the customer. The refunded amount is capped at the amount available on that charge (i.e. ",(0,a.jsx)(n.code,{children:"Math.min(calculatedProration, chargeAmount - alreadyRefunded)"}),"). This means the actual refunded amount may be less than the calculated proration if the original charge was itself prorated over a shorter window than the addon's full period."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"batch-purchase",children:"Batch Purchase"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:'POST /addon/purchase-batch\n\n{\n  "purchases": [\n    { "addonType": "EXTRA_SEAT", "quantity": 2 },\n    { "addonType": "CRM_CALENDAR_SYNC", "quantity": 1 }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"check-free-allowance",children:"Check Free Allowance"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:"GET /addon/free-addons/CRM_CALENDAR_SYNC\n"})}),"\n",(0,a.jsx)(n.h3,{id:"language-specific-endpoints",children:"Language-Specific Endpoints"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-http",children:"GET /addon/available-languages\nGET /addon/multi-language/preferences\nPATCH /addon/multi-language/preferences\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"response-fields",children:"Response Fields"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:[(0,a.jsx)(n.code,{children:"GET /addon/available"})," (available addons):"]})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"billingInterval"})," \u2014 top-level, user's current plan billing interval"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"priceEur"})," \u2014 monthly base price in pence, always present"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"yearlyPriceEur"})," \u2014 ",(0,a.jsx)(n.code,{children:"priceEur \xd7 12"}),", always present"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"effectivePriceEur"})," \u2014 actual charge amount based on billing interval; use this for the primary price display"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"currentQuantity"}),", ",(0,a.jsx)(n.code,{children:"basePlanAllowance"}),", ",(0,a.jsx)(n.code,{children:"maxAllowed"}),", ",(0,a.jsx)(n.code,{children:"remainingPurchasable"}),", ",(0,a.jsx)(n.code,{children:"isIncludedInPlan"})]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:[(0,a.jsx)(n.code,{children:"GET /addon/purchased"})," (purchased addons):"]})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"quantity"}),": Total count"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"active"}),": Currently active (not scheduled for cancellation)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"scheduledForCancellation"}),": Count cancelling at end of billing cycle"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"priceEur"}),": Monthly base price in pence"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"billingType"}),": ",(0,a.jsx)(n.code,{children:'"RECURRING"'})," or ",(0,a.jsx)(n.code,{children:'"PER_USAGE"'})," \u2014 the addon's pricing model (static, from addon definition)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"billingInterval"}),": ",(0,a.jsx)(n.code,{children:'"MONTHLY"'})," or ",(0,a.jsx)(n.code,{children:'"YEARLY"'})," \u2014 the interval at which this addon was purchased (stored on the addon record, not derived from current plan)"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"MULTI_LANGUAGE_AI Only:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"instances[]"}),": Array of individual addon records"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"instances[].id"}),": Use for cancellation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"instances[].language"}),": Language code"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"instances[].billingInterval"}),": Interval for this specific instance"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"instances[].purchasedAt"}),": ISO timestamp of purchase"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"instances[].scheduledForCancellation"}),": Boolean"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"displaying-addon-prices",children:"Displaying Addon Prices"}),"\n",(0,a.jsxs)(n.p,{children:["Use ",(0,a.jsx)(n.code,{children:"effectivePriceEur"})," and ",(0,a.jsx)(n.code,{children:"billingInterval"})," from the ",(0,a.jsx)(n.code,{children:"GET /addon/available"})," response directly \u2014 no manual calculation needed:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:'function formatAddonPrice(\n  addon: AvailableAddon,\n  billingInterval: "MONTHLY" | "YEARLY"\n) {\n  const effective = addon.effectivePriceEur / 100;\n  if (billingInterval === "YEARLY") {\n    const monthly = addon.priceEur / 100;\n    return {\n      label: `\xa3${effective.toFixed(2)}/year`,\n      subLabel: `\xa3${monthly.toFixed(2)}/mo equivalent`,\n    };\n  }\n  return {\n    label: `\xa3${effective.toFixed(2)}/month`,\n    subLabel: null,\n  };\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Example display:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"// billingInterval and effectivePriceEur come directly from GET /addon/available\nconst { billingInterval, addons } = await getAvailableAddons();\n\naddons.map((addon) => {\n  const { label, subLabel } = formatAddonPrice(addon, billingInterval);\n  return (\n    <PriceTag>\n      {label}\n      {subLabel && <SmallText>{subLabel}</SmallText>}\n    </PriceTag>\n  );\n});\n"})}),"\n",(0,a.jsx)(n.p,{children:"For comparison UIs showing both prices side by side:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"<MonthlyPrice>{(addon.priceEur / 100).toFixed(2)}/mo</MonthlyPrice>\n<YearlyPrice>{(addon.yearlyPriceEur / 100).toFixed(2)}/yr</YearlyPrice>\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"validation-rules",children:"Validation Rules"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Purchase Limits:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Active count + new quantity \u2264 plan max"}),"\n",(0,a.jsx)(n.li,{children:"Scheduled cancellations don't block new purchases"}),"\n",(0,a.jsx)(n.li,{children:"Example: Plan allows 10 seats. Have 5 active, 3 scheduled. Can purchase 5 more."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"MULTI_LANGUAGE_AI:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Must select languages before purchase"}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"languages.length === quantity"})}),"\n",(0,a.jsx)(n.li,{children:"Cannot modify languages after purchase (must cancel and repurchase)"}),"\n",(0,a.jsx)(n.li,{children:"Each addon = 1 language"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Feature Addons:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If included in plan, cannot purchase"}),"\n",(0,a.jsx)(n.li,{children:"Max quantity usually 1"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Common Errors:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'// 400 - Plan doesn\'t support addons\n{ "message": "Individual plan does not support addon purchases" }\n\n// 400 - Exceeds limit\n{ "message": "Cannot exceed 10 total seats for BUSINESS plan..." }\n\n// 400 - Language mismatch\n{ "message": "You have selected 2 language(s) but are purchasing 1 addon(s)" }\n\n// 400 - Already included\n{ "message": "CRM/Calendar Sync is already included in your PREMIUM plan" }\n\n// 400 - Modify locked languages\n{ "message": "Language preferences cannot be modified after purchase..." }\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"ui-patterns",children:"UI Patterns"}),"\n",(0,a.jsx)(n.h3,{id:"display-purchased-addons",children:"Display Purchased Addons"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:'{\n  addon.scheduledForCancellation > 0 && (\n    <Badge variant="warning">\n      {addon.scheduledForCancellation} cancelling on{" "}\n      {formatDate(firstExpiryDate)}\n    </Badge>\n  );\n}\n<Text>\n  {addon.active} active / {addon.quantity} total\n</Text>;\n'})}),"\n",(0,a.jsx)(n.h3,{id:"show-billing-info-on-purchased-addon",children:"Show Billing Info on Purchased Addon"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:'// billingType describes the pricing model ("RECURRING" or "PER_USAGE")\n// billingInterval describes the renewal cycle ("MONTHLY" or "YEARLY")\n<Badge variant={addon.billingType === "RECURRING" ? "blue" : "gray"}>\n  {addon.billingType === "RECURRING" ? "Subscription" : "One-time"}\n</Badge>\n<Badge variant={addon.billingInterval === "YEARLY" ? "purple" : "default"}>\n  {addon.billingInterval === "YEARLY" ? "Yearly" : "Monthly"}\n</Badge>\n'})}),"\n",(0,a.jsx)(n.h3,{id:"multi_language_ai-instance-list",children:"MULTI_LANGUAGE_AI Instance List"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"{\n  addon.instances.map((instance) => (\n    <Row key={instance.id}>\n      <Language>{instance.language}</Language>\n      {instance.scheduledForCancellation ? (\n        <Badge>Expires {formatDate(instance.expiresAt)}</Badge>\n      ) : (\n        <CancelButton onClick={() => cancel(instance.id)} />\n      )}\n    </Row>\n  ));\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"purchase-flow",children:"Purchase Flow"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:'// 1. Fetch availability \u2014 includes billingInterval and pricing\nconst { addons, billingInterval } = await getAvailableAddons();\nconst addon = addons.find((a) => a.type === addonType);\n\n// 2. Show the correct price to the user\nconst { label } = formatAddonPrice(addon, billingInterval);\n\n// 3. For MULTI_LANGUAGE_AI\nif (addonType === "MULTI_LANGUAGE_AI") {\n  await updatePreferences({ languages: selectedLanguages });\n}\n\n// 4. Purchase (billing interval is automatic \u2014 derived from user\'s plan on the backend)\nawait purchase({ addonType, quantity });\n'})}),"\n",(0,a.jsx)(n.h3,{id:"quantity-limits",children:"Quantity Limits"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"const canPurchase = addon.remainingPurchasable > 0;\nconst maxQuantity = addon.remainingPurchasable;\n\n<Input max={maxQuantity} disabled={!canPurchase} />;\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"state-management",children:"State Management"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Track locally:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Selected languages (for MULTI_LANGUAGE_AI)"}),"\n",(0,a.jsx)(n.li,{children:"Purchase quantities"}),"\n",(0,a.jsx)(n.li,{children:"Cancellation confirmations"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Refetch after:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Purchase success"}),"\n",(0,a.jsx)(n.li,{children:"Cancellation success"}),"\n",(0,a.jsx)(n.li,{children:"Plan change"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Optimistic updates:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Show loading state during purchase"}),"\n",(0,a.jsx)(n.li,{children:"Don't optimistically update - wait for API confirmation"}),"\n",(0,a.jsx)(n.li,{children:"Scheduled cancellations remain visible until expiry"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"plan-integration",children:"Plan Integration"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"On plan upgrade/downgrade:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Addons transfer if within new limits"}),"\n",(0,a.jsx)(n.li,{children:"Excess addons get refunded"}),"\n",(0,a.jsx)(n.li,{children:"Language preferences may be truncated"}),"\n",(0,a.jsxs)(n.li,{children:["Refetch ",(0,a.jsx)(n.code,{children:"/addon/purchased"})," after plan change"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"On billing interval change (monthly \u2192 yearly):"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Existing monthly addons remain until their ",(0,a.jsx)(n.code,{children:"expiresAt"})]}),"\n",(0,a.jsx)(n.li,{children:"New addon purchases after the switch will use yearly pricing"}),"\n",(0,a.jsxs)(n.li,{children:["Refetch ",(0,a.jsx)(n.code,{children:"/addon/purchased"})," after the yearly subscription activates"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Check plan features:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"if (addon.isIncludedInPlan) {\n  return <Badge>Included in your plan</Badge>;\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>r});var l=i(6540);const a={},s=l.createContext(a);function d(e){const n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);