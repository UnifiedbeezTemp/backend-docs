"use strict";(globalThis.webpackChunkbackend_docs=globalThis.webpackChunkbackend_docs||[]).push([[5913],{949:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"copilot-integration","title":"OLD GUIDE - THIS IS DEPRECATED, USE [NEW GUIDE](./new-copilot-integration)","description":"Base URL","source":"@site/docs/copilot-integration.md","sourceDirName":".","slug":"/copilot-integration","permalink":"/backend-docs/docs/copilot-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/copilot-integration.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"tutorialSidebar","previous":{"title":"Frontend Twilio SMS Integration Flow","permalink":"/backend-docs/docs/twilio-integration"},"next":{"title":"Channel AI Recommendations API Documentation","permalink":"/backend-docs/docs/smart-suggestion-beebot"}}');var i=s(4848),r=s(8453);const a={sidebar_position:10},o="OLD GUIDE - THIS IS DEPRECATED, USE NEW GUIDE",c={},l=[{value:"Base URL",id:"base-url",level:2},{value:"Authentication",id:"authentication",level:2},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"1. Start Conversation",id:"1-start-conversation",level:3},{value:"2. Send Message",id:"2-send-message",level:3},{value:"3. Edit Previous Step",id:"3-edit-previous-step",level:3},{value:"4. Skip Substep",id:"4-skip-substep",level:3},{value:"5. Get Current State",id:"5-get-current-state",level:3},{value:"6. Restart Conversation",id:"6-restart-conversation",level:3},{value:"7. Change Plan",id:"7-change-plan",level:3},{value:"8. AI Assist (Optional)",id:"8-ai-assist-optional",level:3},{value:"Frontend Flow",id:"frontend-flow",level:2},{value:"Initial Load",id:"initial-load",level:3},{value:"User Responds",id:"user-responds",level:3},{value:"Handle Special Cases",id:"handle-special-cases",level:3},{value:"UI Directives Reference",id:"ui-directives-reference",level:2},{value:"Bot Message &amp; Components",id:"bot-message--components",level:2},{value:"Last User Message",id:"last-user-message",level:2},{value:"Special Substeps Handling",id:"special-substeps-handling",level:2},{value:"planConfirmation",id:"planconfirmation",level:3},{value:"changePlan",id:"changeplan",level:3},{value:"categoryNotListed",id:"categorynotlisted",level:3},{value:"businessName",id:"businessname",level:3},{value:"selectBusinessNameMatch",id:"selectbusinessnamematch",level:3},{value:"confirmBusinessData",id:"confirmbusinessdata",level:3},{value:"businessNotListed",id:"businessnotlisted",level:3},{value:"beezaroAssistants",id:"beezaroassistants",level:3},{value:"Bot Message Structure",id:"bot-message-structure",level:2},{value:"Last User Message",id:"last-user-message-1",level:2},{value:"Progress Tracking",id:"progress-tracking",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"State Persistence",id:"state-persistence",level:2},{value:"TypeScript Types",id:"typescript-types",level:2},{value:"Testing Checklist",id:"testing-checklist",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsxs)(n.h1,{id:"old-guide---this-is-deprecated-use-new-guide",children:["OLD GUIDE - THIS IS DEPRECATED, USE ",(0,i.jsx)(n.a,{href:"./new-copilot-integration",children:"NEW GUIDE"})]})}),"\n",(0,i.jsx)(n.h1,{id:"copilot-onboarding---frontend-integration-guide",children:"Copilot Onboarding - Frontend Integration Guide"}),"\n",(0,i.jsx)(n.h2,{id:"base-url",children:"Base URL"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/copilot\n"})}),"\n",(0,i.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsxs)(n.p,{children:["All endpoints require JWT authentication via ",(0,i.jsx)(n.code,{children:"SessionAuthGuard"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,i.jsx)(n.h3,{id:"1-start-conversation",children:"1. Start Conversation"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"/copilot/start"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Initialize new copilot onboarding session"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  botMessage: string;\n  currentSubstep: {\n    id: string;\n    name: string;\n    type: 'choice' | 'input' | 'custom' | 'button';\n    botMessage: string; // Interpolated text only\n    options?: Array<{\n      label: string;\n      value: any;\n      type: 'radio' | 'select' | 'button';\n      emoji?: string;\n      nextSubstepId?: string;\n      isCustom?: boolean;\n    }>;\n    canEdit?: boolean;\n    canSkip?: boolean;\n    formField?: string;\n    optionsMobileType?: string;\n  };\n  uiDirectives?: {\n    components?: Array<{ name: string; metadata?: any }>;\n    showAttachment?: boolean;\n    [key: string]: any;\n  };\n  lastUserMessage?: {\n    messageType: string;\n    content: string;\n    metadata: any;\n    createdAt: string;\n  };\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const response = await fetch("/copilot/start", {\n  method: "POST",\n  headers: { Authorization: `Bearer ${token}` },\n});\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"2-send-message",children:"2. Send Message"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"/copilot/message"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Send user response (selection, text input, file upload)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  content: string;                    // User's selection/input value\n  inputType?: 'text' | 'choice' | 'file';\n  metadata?: {\n    selectedOption?: any;\n    formField?: string;\n    [key: string]: any;\n  };\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response:"})," Same as ",(0,i.jsx)(n.code,{children:"/start"})," response"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Examples:"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Choice (Button/Option Selection):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'await fetch("/copilot/message", {\n  method: "POST",\n  headers: { "Content-Type": "application/json" },\n  body: JSON.stringify({\n    content: "HEALTHCARE_CLINICS",\n    inputType: "choice",\n    metadata: {\n      selectedOption: "HEALTHCARE_CLINICS",\n      formField: "industry",\n    },\n  }),\n});\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Text Input:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'await fetch("/copilot/message", {\n  method: "POST",\n  body: JSON.stringify({\n    content: "Dental Care Plus",\n    inputType: "text",\n    metadata: { formField: "businessName" },\n  }),\n});\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"General Chat (No formField):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// User types: "I run a dental clinic"\nawait fetch("/copilot/message", {\n  method: "POST",\n  body: JSON.stringify({\n    content: "I run a dental clinic",\n    inputType: "text",\n    // No formField = triggers AI intent recognition\n  }),\n});\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"3-edit-previous-step",children:"3. Edit Previous Step"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"/copilot/edit/:substepId"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Go back and change a previous answer"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  substepId: string; // Also in URL param\n  newValue: any;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  botMessage: string;\n  currentSubstep: object;\n  uiDirectives?: {\n    requiresReconfiguration?: string[];  // Affected substep IDs\n  };\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// User wants to change team size\nawait fetch("/copilot/edit/teamSize", {\n  method: "POST",\n  body: JSON.stringify({\n    substepId: "teamSize",\n    newValue: "6-20",\n  }),\n});\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"4-skip-substep",children:"4. Skip Substep"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"/copilot/skip"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Skip current substep (if allowed)"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  substepId: string;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response:"})," Same as ",(0,i.jsx)(n.code,{children:"/message"})," response"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"5-get-current-state",children:"5. Get Current State"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"GET"})," ",(0,i.jsx)(n.code,{children:"/copilot/state"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Retrieve current conversation state and progress"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  conversationId: number;\n  currentSection: string;\n  currentSubstep: string;\n  sessionState: {\n    current_section: string;\n    current_substep: string;\n    last_interaction: string;\n    collected_data: {\n      confirmed_plan?: boolean;\n      selected_plan?: 'INDIVIDUAL' | 'BUSINESS' | 'PREMIUM' | 'ORGANISATION';\n      industry?: string;\n      business_name?: string;\n      selected_business?: {\n        name: string;\n        address?: string;\n        phone?: string;\n        email?: string;\n        website?: string;\n        logo_url?: string;\n      };\n      team_size?: string;\n      team_members?: Array<{ email: string; name?: string; role?: string }>;\n      selected_channels?: string[];\n      no_reply_action?: 'wait' | 'escalate' | 'followUp';\n      ai_setup_type?: 'single' | 'multiple';\n      selected_automations?: string[];\n    };\n    completed_sections: string[];\n    completed_substeps: string[];\n    skipped_substeps: string[];\n    edit_history: Array<{\n      section: string;\n      substep: string;\n      field: string;\n      old_value: any;\n      new_value: any;\n      timestamp: string;\n      affected_substeps?: string[];\n    }>;\n  };\n  isActive: boolean;\n  isCompleted: boolean;\n  recentMessages: Array<{\n    messageType: 'USER_INPUT' | 'USER_SELECTION' | 'USER_EDIT' | 'AI_RESPONSE' | 'SECTION_COMPLETE' | 'SYSTEM';\n    content: string;\n    metadata: {\n      section: string;\n      substep: string;\n      action: string;\n      formField?: string;\n      selectedValue?: any;\n      substepConfig?: {\n        id: string;\n        type: 'choice' | 'input' | 'custom' | 'button';\n        canEdit: boolean;\n        canSkip?: boolean;\n        formField?: string;\n        botMessage: string;\n        options?: Array<{\n          label: string;\n          value: any;\n          type: 'radio' | 'select' | 'button';\n          emoji?: string;\n          nextSubstepId?: string;\n          isCustom?: boolean;\n        }>;\n      };\n    };\n    createdAt: string;\n  }>;\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"6-restart-conversation",children:"6. Restart Conversation"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"/copilot/restart"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Mark current conversation inactive and start fresh"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Response:"})," Same as ",(0,i.jsx)(n.code,{children:"/start"})," response"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"7-change-plan",children:"7. Change Plan"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"/copilot/change-plan"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Switch user's plan mid-onboarding"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'{\n  newPlan: "INDIVIDUAL" | "BUSINESS" | "PREMIUM" | "ORGANISATION";\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Response:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  botMessage: string;\n  currentSubstep: object;\n  uiDirectives?: {\n    requiresReconfiguration?: string[];\n  };\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// User clicks "Change plan" button\nawait fetch("/copilot/change-plan", {\n  method: "POST",\n  body: JSON.stringify({\n    newPlan: "BUSINESS",\n  }),\n});\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"8-ai-assist-optional",children:"8. AI Assist (Optional)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"POST"})," ",(0,i.jsx)(n.code,{children:"/copilot/ai-assist"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Description:"})," Direct access to Python Lambda AI services"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Request Body:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"{\n  action: 'suggest_industry' | 'generate_goals_objectives' | 'parse_intent';\n  user_input: string;\n  context?: any;\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"frontend-flow",children:"Frontend Flow"}),"\n",(0,i.jsx)(n.h3,{id:"initial-load",children:"Initial Load"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// 1. Start conversation\nconst { botMessage, currentSubstep } = await POST("/copilot/start");\n\n// 2. Display bot message\ndisplayMessage(botMessage);\n\n// 3. Render UI based on substep type\nif (currentSubstep.type === "choice") {\n  renderOptions(currentSubstep.options);\n} else if (currentSubstep.type === "input") {\n  renderTextInput();\n} else if (currentSubstep.type === "custom") {\n  renderCustomComponent(currentSubstep.attachment.name);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"user-responds",children:"User Responds"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// User selects option or enters text\nconst response = await POST("/copilot/message", {\n  content: userSelection,\n  inputType: "selection",\n  metadata: {\n    selectedOption: userSelection,\n    formField: currentSubstep.formField,\n  },\n});\n\n// Update UI\ndisplayMessage(response.botMessage);\nrenderSubstep(response.currentSubstep);\n'})}),"\n",(0,i.jsx)(n.h3,{id:"handle-special-cases",children:"Handle Special Cases"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Plan Upgrade Prompt:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'if (response.uiDirectives?.showPlanUpgrade) {\n  showModal({\n    message: response.botMessage,\n    suggestedPlan: response.uiDirectives.suggestedPlan,\n    onUpgrade: () =>\n      POST("/copilot/change-plan", {\n        newPlan: response.uiDirectives.suggestedPlan,\n      }),\n  });\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Reconfiguration Required:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'if (response.uiDirectives?.requiresReconfiguration) {\n  const affectedSteps = response.uiDirectives.requiresReconfiguration;\n  showNotification(`Changes affect: ${affectedSteps.join(", ")}`);\n  // Backend automatically redirects to first affected step\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Section Complete:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"if (response.sectionComplete) {\n  showSectionCompleteAnimation();\n  updateProgressBar(sessionState.completed_sections.length / 6);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Conversation Complete:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'if (response.conversationComplete) {\n  redirectTo("/dashboard");\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"ui-directives-reference",children:"UI Directives Reference"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Directive"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"When Used"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"components"})}),(0,i.jsx)(n.td,{children:"array"}),(0,i.jsx)(n.td,{children:"Components to render alongside bot message"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"showPlanUpgrade"})}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{children:"User selection exceeds current plan"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"suggestedPlan"})}),(0,i.jsx)(n.td,{children:"PlanType"}),(0,i.jsx)(n.td,{children:"Which plan to upgrade to"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"highlightOption"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Auto-suggest from AI parsing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"requiresReconfiguration"})}),(0,i.jsx)(n.td,{children:"string[]"}),(0,i.jsx)(n.td,{children:"Edit triggered reconfiguration"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"bot-message--components",children:"Bot Message & Components"}),"\n",(0,i.jsx)(n.p,{children:"Bot messages support text + component rendering:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'{\n  "botMessage": "Hi Joshua, I\'m Beezaro\\n\\nPlease confirm your plan",\n  "uiDirectives": {\n    "components": [\n      { "name": "planSummary", "metadata": {} }\n    ]\n  }\n}\n\n// Render\n<BotMessage>{response.botMessage}</BotMessage>\n{response.uiDirectives?.components?.map(comp =>\n  <Component name={comp.name} {...comp.metadata} />\n)}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Available components:"})," ",(0,i.jsx)(n.code,{children:"planSummary"}),", ",(0,i.jsx)(n.code,{children:"plansPreview"}),", ",(0,i.jsx)(n.code,{children:"businessLogo"}),", ",(0,i.jsx)(n.code,{children:"logoUpload"}),", ",(0,i.jsx)(n.code,{children:"AssistantCard"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"last-user-message",children:"Last User Message"}),"\n",(0,i.jsx)(n.p,{children:"Responses include the user's message:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'{\n  "lastUserMessage": {\n    "messageType": "USER_SELECTION",\n    "content": "HEALTHCARE_CLINICS",\n    "metadata": { ... },\n    "createdAt": "2025-12-22T12:00:00.000Z"\n  }\n}\n\n// Use for immediate UI update\nappendMessage(response.lastUserMessage);\nappendMessage({ type: \'bot\', content: response.botMessage });\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"special-substeps-handling",children:"Special Substeps Handling"}),"\n",(0,i.jsx)(n.h3,{id:"planconfirmation",children:"planConfirmation"}),"\n",(0,i.jsx)(n.p,{children:"Render plan summary component:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'if (response.uiDirectives?.components?.some((c) => c.name === "planSummary")) {\n  renderPlanSummary(userData.plan);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"changeplan",children:"changePlan"}),"\n",(0,i.jsx)(n.p,{children:"Render plans preview:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'if (response.uiDirectives?.components?.some((c) => c.name === "plansPreview")) {\n  const plans = await fetchPlans();\n  renderPlansGrid(plans);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"categorynotlisted",children:"categoryNotListed"}),"\n",(0,i.jsx)(n.p,{children:"Text input triggers AI suggestion:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// User types business description\nconst response = await POST("/copilot/message", {\n  content: "I run a dental clinic",\n  inputType: "text",\n});\n\n// Backend returns suggested industry with highlight\nif (response.uiDirectives?.highlightOption) {\n  highlightIndustryChip(response.uiDirectives.highlightOption);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"businessname",children:"businessName"}),"\n",(0,i.jsx)(n.p,{children:"After input, searches for matches:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const response = await POST("/copilot/message", {\n  content: "Dental Care Plus",\n  metadata: { formField: "businessName" },\n});\n\n// Backend automatically searches and moves to selectBusinessNameMatch\n// Next substep shows business options\n'})}),"\n",(0,i.jsx)(n.h3,{id:"selectbusinessnamematch",children:"selectBusinessNameMatch"}),"\n",(0,i.jsx)(n.p,{children:"Shows scraped business data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"currentSubstep.options.forEach((business) => {\n  renderBusinessCard({\n    name: business.label,\n    details: business.value, // Contains address, phone, email, website, logo\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h3,{id:"confirmbusinessdata",children:"confirmBusinessData"}),"\n",(0,i.jsx)(n.p,{children:"Shows business data preview:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'if (currentSubstep.attachment?.name === "businessDataPreview") {\n  renderBusinessPreview(sessionState.collected_data.selected_business);\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"businessnotlisted",children:"businessNotListed"}),"\n",(0,i.jsx)(n.p,{children:"Render logo upload component. Upload directly to backend endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'if (response.uiDirectives?.components?.some((c) => c.name === "logoUpload")) {\n  renderFileUploader({\n    accept: "image/png,image/jpeg,image/jpg,image/webp",\n    maxSize: 5 * 1024 * 1024, // 5MB\n    onUpload: async (file) => {\n      const formData = new FormData();\n      formData.append("logo", file);\n      formData.append("substepId", "businessNotListed");\n\n      const response = await POST("/copilot/upload-logo", formData, {\n        headers: { "Content-Type": "multipart/form-data" },\n      });\n\n      // Response advances to next section automatically\n      updateUI(response);\n    },\n  });\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Allowed types: PNG, JPG, JPEG, WebP"}),"\n",(0,i.jsx)(n.li,{children:"Max size: 5MB"}),"\n",(0,i.jsxs)(n.li,{children:["Completes ",(0,i.jsx)(n.code,{children:"businessNotListed"})," substep and advances to next section"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"beezaroassistants",children:"beezaroAssistants"}),"\n",(0,i.jsx)(n.p,{children:"Render AI assistant cards:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'const assistantComponents = response.uiDirectives?.components?.filter(\n  (c) => c.name === "AssistantCard"\n);\n\nassistantComponents?.forEach((comp) => {\n  renderAssistantCard({\n    name: comp.metadata.name,\n    tags: comp.metadata.tags,\n    id: comp.metadata.id,\n  });\n});\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"bot-message-structure",children:"Bot Message Structure"}),"\n",(0,i.jsx)(n.p,{children:"Bot messages now use an array format supporting both text and components:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "botMessage": "Hi Joshua, I\'m Beezaro\\n\\nPlease confirm that you selected the BUSINESS plan",\n  "currentSubstep": {\n    "botMessage": "Hi Joshua, I\'m Beezaro\\n\\nPlease confirm that you selected the BUSINESS plan"\n    // ... other fields\n  },\n  "uiDirectives": {\n    "components": [\n      {\n        "name": "planSummary",\n        "metadata": {}\n      }\n    ]\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Backend processing:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Extracts text messages from array"}),"\n",(0,i.jsxs)(n.li,{children:["Interpolates variables like ",(0,i.jsx)(n.code,{children:"{firstName}"}),", ",(0,i.jsx)(n.code,{children:"{selectedPlan}"})]}),"\n",(0,i.jsxs)(n.li,{children:["Returns plain text in ",(0,i.jsx)(n.code,{children:"botMessage"})]}),"\n",(0,i.jsxs)(n.li,{children:["Returns components separately in ",(0,i.jsx)(n.code,{children:"uiDirectives.components"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Frontend rendering:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Display bot text\n<BotMessage>{response.botMessage}</BotMessage>;\n\n// Render components\n{\n  response.uiDirectives?.components?.map((comp) => {\n    switch (comp.name) {\n      case "planSummary":\n        return <PlanSummaryCard {...comp.metadata} />;\n      case "businessLogo":\n        return <BusinessLogoPreview {...comp.metadata} />;\n      case "AssistantCard":\n        return <AssistantCard {...comp.metadata} />;\n      // ... other components\n    }\n  });\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Available components:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"planSummary"})," - Display user's plan details"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"plansPreview"})," - Show all available plans for selection"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"businessLogo"})," - Preview selected business logo"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"logoUpload"})," - File upload for business logo"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"AssistantCard"})," - AI assistant configuration card"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"last-user-message-1",children:"Last User Message"}),"\n",(0,i.jsxs)(n.p,{children:["Each message in ",(0,i.jsx)(n.code,{children:"recentMessages"})," contains full substep configuration to enable accurate UI reconstruction:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'{\n  "messageType": "USER_SELECTION",\n  "content": "HEALTHCARE_CLINICS",\n  "metadata": {\n    "section": "businessIdentity",\n    "substep": "businessIndustry",\n    "action": "select",\n    "formField": "industry",\n    "selectedValue": "HEALTHCARE_CLINICS",\n    "substepConfig": {\n      "id": "businessIndustry",\n      "type": "choice",\n      "canEdit": true,\n      "canSkip": true,\n      "formField": "industry",\n      "botMessage": "Next, which industry does your business belong to?",\n      "options": [\n        {\n          "emoji": "\ud83d\udecd\ufe0f",\n          "label": "E-commerce / Retail",\n          "value": "ECOMMERCE_RETAIL",\n          "type": "radio",\n          "nextSubstepId": "businessName"\n        },\n        {\n          "emoji": "\ud83c\udfe5",\n          "label": "Healthcare / Clinics",\n          "value": "HEALTHCARE_CLINICS",\n          "type": "radio",\n          "nextSubstepId": "businessName"\n        }\n        // ... more options\n      ]\n    }\n  },\n  "createdAt": "2025-12-22T12:00:00.000Z"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Why substepConfig is included:"})}),"\n",(0,i.jsxs)(n.p,{children:["Backend is the single source of truth. Frontend doesn't need to maintain or parse ",(0,i.jsx)(n.code,{children:"copilotSteps.json"})," - all UI rendering data comes from API responses."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Rendering past messages:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Render user's past selection with context\nconst message = recentMessages[0];\nconst { substepConfig, selectedValue } = message.metadata;\n\n// Show what options were available\nconst selectedOption = substepConfig.options.find(\n  (opt) => opt.value === selectedValue\n);\n\nreturn (\n  <MessageBubble>\n    <BotMessage>{substepConfig.botMessage}</BotMessage>\n    <OptionsGrid>\n      {substepConfig.options.map((option) => (\n        <Option\n          key={option.value}\n          selected={option.value === selectedValue}\n          disabled={!substepConfig.canEdit}\n        >\n          {option.emoji} {option.label}\n        </Option>\n      ))}\n    </OptionsGrid>\n    <UserResponse>{selectedOption.label}</UserResponse>\n  </MessageBubble>\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Edit functionality:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"// Check if message can be edited\nif (message.metadata.substepConfig?.canEdit) {\n  showEditButton(() => {\n    // Call /copilot/edit/:substepId with new value\n    editSubstep(message.metadata.substep, newValue);\n  });\n}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"progress-tracking",children:"Progress Tracking"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Get state to show progress\nconst state = await GET("/copilot/state");\n\nconst progress = {\n  currentSection: state.currentSection,\n  completedSections: state.sessionState.completed_sections,\n  totalSections: 6,\n  percentage: (state.sessionState.completed_sections.length / 6) * 100,\n};\n\nrenderProgressBar(progress);\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'try {\n  const response = await POST("/copilot/message", data);\n} catch (error) {\n  if (error.status === 404) {\n    // No active conversation\n    redirectTo("/copilot/start");\n  } else if (error.status === 400) {\n    // Invalid input\n    showError(error.message);\n  } else {\n    // Server error\n    showError("Something went wrong. Please try again.");\n  }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"state-persistence",children:"State Persistence"}),"\n",(0,i.jsx)(n.p,{children:"Backend handles all state persistence. Frontend can refresh/navigate away safely:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// On page load\nconst state = await GET("/copilot/state");\n\nif (state.isCompleted) {\n  redirectTo("/dashboard");\n} else if (state.isActive) {\n  // Resume from current position\n  displaySubstep(state.currentSubstep);\n} else {\n  // No conversation - start new\n  redirectTo("/copilot/start");\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"typescript-types",children:"TypeScript Types"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'type PlanType = "INDIVIDUAL" | "BUSINESS" | "PREMIUM" | "ORGANISATION";\n\ntype SubstepType = "choice" | "input" | "custom" | "button";\n\ntype InputType = "text" | "choice" | "file";\n\ninterface SubstepOption {\n  label: string;\n  value: any;\n  type: "radio" | "select" | "button";\n  emoji?: string;\n  nextSubstepId?: string;\n  isCustom?: boolean;\n  recommended?: boolean;\n  hasSubselect?: boolean;\n  options?: SubstepOption[];\n}\n\ninterface Substep {\n  id: string;\n  name: string;\n  type: SubstepType;\n  botMessage: string;\n  options?: SubstepOption[];\n  attachment?: {\n    name: string;\n    data: any;\n  };\n  canEdit?: boolean;\n  canSkip?: boolean;\n  formField?: string;\n  isEndOfStep?: boolean;\n}\n\ninterface SendMessagePayload {\n  content: string;\n  inputType?: InputType;\n  metadata?: {\n    selectedOption?: any;\n    formField?: string;\n  };\n}\n\ninterface CopilotResponse {\n  botMessage: string;\n  currentSubstep: Substep;\n  nextSubstepId?: string;\n  uiDirectives?: {\n    components?: Array<{ name: string; metadata?: any }>;\n    showPlanUpgrade?: boolean;\n    suggestedPlan?: PlanType;\n    highlightOption?: string;\n    requiresReconfiguration?: string[];\n    assistantSuggestions?: {\n      tone: string;\n      style: string;\n      personality: string;\n    };\n    possibleQuery?: string;\n  };\n  lastUserMessage?: {\n    messageType: string;\n    content: string;\n    metadata: any;\n    createdAt: string;\n  };\n  sectionComplete?: boolean;\n  conversationComplete?: boolean;\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Start conversation displays first substep"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Button selections advance flow"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Text inputs work correctly"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","General chat triggers AI parsing"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Plan upgrade modal appears when needed"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Edit redirects to previous step"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Skip hides dependent substeps"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Section completion shows animation"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Progress bar updates correctly"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","State persists across refreshes"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Restart clears and begins fresh"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Completion redirects to dashboard"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Error states handled gracefully"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);