"use strict";(globalThis.webpackChunkbackend_docs=globalThis.webpackChunkbackend_docs||[]).push([[4860],{2180:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"frontend-billing-integration","title":"Frontend Billing Integration Guide","description":"This document covers everything the frontend needs to implement trial setup, subscription billing, and payment method management.","source":"@site/docs/frontend-billing-integration.md","sourceDirName":".","slug":"/frontend-billing-integration","permalink":"/backend-docs/docs/frontend-billing-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/frontend-billing-integration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Updated Copilot Testing Guide","permalink":"/backend-docs/docs/copilot/copilot-postman-testing"}}');var s=t(4848),i=t(8453);const d={},a="Frontend Billing Integration Guide",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Setup",id:"setup",level:2},{value:"Reading the User&#39;s Payment State",id:"reading-the-users-payment-state",level:2},{value:"Flow 1: Trial Setup (New Users)",id:"flow-1-trial-setup-new-users",level:2},{value:"Step 1 \u2014 Select plan and call <code>confirmTrial</code>",id:"step-1--select-plan-and-call-confirmtrial",level:3},{value:"Step 2 \u2014 Collect card with Stripe Elements",id:"step-2--collect-card-with-stripe-elements",level:3},{value:"Step 3 \u2014 Attach the payment method",id:"step-3--attach-the-payment-method",level:3},{value:"Flow 2: Updating a Saved Card (Existing Users)",id:"flow-2-updating-a-saved-card-existing-users",level:2},{value:"Step 1 \u2014 Create a new SetupIntent",id:"step-1--create-a-new-setupintent",level:3},{value:"Step 2 \u2014 Collect the new card with Stripe Elements",id:"step-2--collect-the-new-card-with-stripe-elements",level:3},{value:"Step 3 \u2014 Save the updated card",id:"step-3--save-the-updated-card",level:3},{value:"Other Billing Endpoints",id:"other-billing-endpoints",level:2},{value:"Subscription status",id:"subscription-status",level:3},{value:"Cancel subscription",id:"cancel-subscription",level:3},{value:"Reactivate subscription",id:"reactivate-subscription",level:3},{value:"Subscription Status Reference",id:"subscription-status-reference",level:2},{value:"Displaying Card Brand",id:"displaying-card-brand",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Reference: Complete Flow Diagram",id:"reference-complete-flow-diagram",level:2},{value:"Reference Component",id:"reference-component",level:2}];function o(e){const n={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"frontend-billing-integration-guide",children:"Frontend Billing Integration Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This document covers everything the frontend needs to implement trial setup, subscription billing, and payment method management."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Billing is built on Stripe. The backend owns all Stripe logic \u2014 the frontend only interacts with two things:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Stripe.js / Stripe Elements"})," \u2014 to securely collect card details in the browser (card numbers never touch your servers)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Backend API endpoints"})," \u2014 to set up intents, attach/update cards, and read billing state"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There are two distinct flows:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Flow"}),(0,s.jsx)(n.th,{children:"When"}),(0,s.jsx)(n.th,{children:"Endpoints"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Trial setup"})}),(0,s.jsx)(n.td,{children:"New user, no card on file"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"POST /auth/setup/trial"})," \u2192 ",(0,s.jsx)(n.em,{children:"(Stripe Elements)"})," \u2192 ",(0,s.jsx)(n.code,{children:"POST /auth/payment/attach"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Card update"})}),(0,s.jsx)(n.td,{children:"Existing user changing saved card"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"POST /payment/create-setup-intent"})," \u2192 ",(0,s.jsx)(n.em,{children:"(Stripe Elements)"})," \u2192 ",(0,s.jsx)(n.code,{children:"POST /payment/update-payment-method"})]})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(n.p,{children:"Install Stripe.js:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm install @stripe/stripe-js @stripe/react-stripe-js\n"})}),"\n",(0,s.jsx)(n.p,{children:"Initialise the Stripe instance once at the top of your app (outside any component so it's not re-created on renders):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'import { loadStripe } from "@stripe/stripe-js";\n\nconst stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY);\n'})}),"\n",(0,s.jsx)(n.p,{children:"The publishable key can also be fetched from the backend:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'GET /payment/config\n\u2192 { publishableKey: "pk_live_..." }\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"reading-the-users-payment-state",children:"Reading the User's Payment State"}),"\n",(0,s.jsxs)(n.p,{children:["The user profile (returned on login, signup, and ",(0,s.jsx)(n.code,{children:"GET /auth/profile"}),") includes a ",(0,s.jsx)(n.code,{children:"paymentMethod"})," field:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// Returned when a card is saved\npaymentMethod: {\n  last4: "4242",\n  brand: "visa",        // "visa" | "mastercard" | "amex" | "discover" | etc.\n  expMonth: 12,\n  expYear: 2027,\n} | null                // null = no card on file\n'})}),"\n",(0,s.jsx)(n.p,{children:"Use this to decide which UI to render:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'if (user.paymentMethod === null) {\n  // Show trial setup / add card prompt\n} else {\n  // Show saved card + "Change card" option\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"You can also fetch card details independently at any time:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"GET /payment/payment-method\nAuthorization: (session cookie)\n\n\u2192 { last4, brand, expMonth, expYear } | null\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"flow-1-trial-setup-new-users",children:"Flow 1: Trial Setup (New Users)"}),"\n",(0,s.jsx)(n.p,{children:"This flow runs when a user has no card on file and wants to start their 30-day trial."}),"\n",(0,s.jsxs)(n.h3,{id:"step-1--select-plan-and-call-confirmtrial",children:["Step 1 \u2014 Select plan and call ",(0,s.jsx)(n.code,{children:"confirmTrial"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'POST /auth/setup/trial\nContent-Type: application/json\n\n{ "planType": "BUSINESS" }   // "INDIVIDUAL" | "BUSINESS" | "PREMIUM" | "ORGANISATION"\n\n\u2192 {\n    "message": "Trial setup initiated",\n    "trialEndsAt": "2025-03-26T10:00:00.000Z",\n    "clientSecret": "seti_..._secret_...",\n    "customerId": "cus_..."\n  }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Store ",(0,s.jsx)(n.code,{children:"clientSecret"})," and ",(0,s.jsx)(n.code,{children:"trialEndsAt"})," \u2014 you'll need them in the next step."]}),"\n",(0,s.jsx)(n.h3,{id:"step-2--collect-card-with-stripe-elements",children:"Step 2 \u2014 Collect card with Stripe Elements"}),"\n",(0,s.jsxs)(n.p,{children:["Wrap the card form in an ",(0,s.jsx)(n.code,{children:"<Elements>"})," provider and use the ",(0,s.jsx)(n.code,{children:"clientSecret"})," from step 1:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:'import { Elements, CardElement, useStripe, useElements } from "@stripe/react-stripe-js";\n\n// In your component tree:\n<Elements stripe={stripePromise}>\n  <CardForm clientSecret={clientSecret} />\n</Elements>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Inside the form, call ",(0,s.jsx)(n.code,{children:"stripe.confirmCardSetup"})," when the user submits:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'const { error, setupIntent } = await stripe.confirmCardSetup(clientSecret, {\n  payment_method: { card: elements.getElement(CardElement) },\n});\n\nif (error) {\n  // Show error.message to the user\n  return;\n}\n\nconst paymentMethodId =\n  typeof setupIntent.payment_method === "string"\n    ? setupIntent.payment_method\n    : setupIntent.payment_method.id;\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Important:"})," ",(0,s.jsx)(n.code,{children:"confirmCardSetup"})," contacts Stripe directly. No card data touches your backend."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"step-3--attach-the-payment-method",children:"Step 3 \u2014 Attach the payment method"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'POST /auth/payment/attach\nContent-Type: application/json\n\n{ "payment_method_id": "pm_..." }\n\n\u2192 {\n    "message": "Payment method attached successfully",\n    "paymentMethod": {\n      "last4": "4242",\n      "brand": "visa",\n      "expMonth": 12,\n      "expYear": 2027\n    }\n  }\n'})}),"\n",(0,s.jsx)(n.p,{children:"This call:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Attaches the card to the Stripe customer"}),"\n",(0,s.jsx)(n.li,{children:"Sets it as the default payment method for future charges"}),"\n",(0,s.jsx)(n.li,{children:"Stores card details in the database"}),"\n",(0,s.jsx)(n.li,{children:"Creates the 30-day trial subscription automatically"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["After this succeeds, update the user's local state with ",(0,s.jsx)(n.code,{children:"paymentMethod"})," from the response and show a success screen."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"flow-2-updating-a-saved-card-existing-users",children:"Flow 2: Updating a Saved Card (Existing Users)"}),"\n",(0,s.jsx)(n.p,{children:"Use this when a user wants to change the card that gets charged."}),"\n",(0,s.jsx)(n.h3,{id:"step-1--create-a-new-setupintent",children:"Step 1 \u2014 Create a new SetupIntent"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'POST /payment/create-setup-intent\n(no body required)\n\n\u2192 {\n    "client_secret": "seti_..._secret_...",\n    "customer_id": "cus_..."\n  }\n'})}),"\n",(0,s.jsx)(n.h3,{id:"step-2--collect-the-new-card-with-stripe-elements",children:"Step 2 \u2014 Collect the new card with Stripe Elements"}),"\n",(0,s.jsxs)(n.p,{children:["Same as trial setup \u2014 use ",(0,s.jsx)(n.code,{children:"stripe.confirmCardSetup"})," with the new ",(0,s.jsx)(n.code,{children:"client_secret"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const { error, setupIntent } = await stripe.confirmCardSetup(clientSecret, {\n  payment_method: { card: elements.getElement(CardElement) },\n});\n\nconst paymentMethodId = /* extract from setupIntent as above */;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-3--save-the-updated-card",children:"Step 3 \u2014 Save the updated card"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'POST /payment/update-payment-method\nContent-Type: application/json\n\n{ "payment_method_id": "pm_..." }\n\n\u2192 {\n    "last4": "1234",\n    "brand": "mastercard",\n    "expMonth": 8,\n    "expYear": 2026\n  }\n'})}),"\n",(0,s.jsx)(n.p,{children:"This call:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Attaches the new card to the Stripe customer"}),"\n",(0,s.jsx)(n.li,{children:"Updates the customer's default payment method (used for all future charges)"}),"\n",(0,s.jsx)(n.li,{children:"Updates the default on the active subscription"}),"\n",(0,s.jsx)(n.li,{children:"Overwrites the stored card details in the database"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Does not"})," modify the subscription or create a new one"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Update the saved card state in your UI with the response."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"other-billing-endpoints",children:"Other Billing Endpoints"}),"\n",(0,s.jsx)(n.h3,{id:"subscription-status",children:"Subscription status"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'GET /payment/subscription-status\n\n\u2192 {\n    "subscription": {\n      "subscriptionId": "sub_...",\n      "status": "trialing",           // "trialing" | "active" | "past_due" | "canceled"\n      "currentPeriodEnd": "2025-03-26T...",\n      "trialEnd": "2025-03-26T..."\n    },\n    "isOnTrial": true,\n    "trialInfo": { "planType": "BUSINESS", ... },\n    "gracePeriod": null,\n    "accessRevoked": null\n  }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"isOnTrial"})," and ",(0,s.jsx)(n.code,{children:"subscription.status"})," to conditionally show trial banners, upgrade prompts, or payment failure notices."]}),"\n",(0,s.jsx)(n.h3,{id:"cancel-subscription",children:"Cancel subscription"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'POST /payment/cancel-subscription\n(no body)\n\n\u2192 { "message": "Subscription cancelled successfully" }\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Cancellation takes effect at the end of the current billing period (",(0,s.jsx)(n.code,{children:"currentPeriodEnd"}),"). The user retains access until then."]}),"\n",(0,s.jsx)(n.h3,{id:"reactivate-subscription",children:"Reactivate subscription"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'POST /payment/reactivate-subscription\n(no body)\n\n\u2192 { "message": "Subscription reactivated successfully" }\n'})}),"\n",(0,s.jsx)(n.p,{children:"Used after a subscription was cancelled or access was revoked due to payment failure."}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"subscription-status-reference",children:"Subscription Status Reference"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"status"})}),(0,s.jsx)(n.th,{children:"Meaning"}),(0,s.jsx)(n.th,{children:"What to show"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"trialing"})}),(0,s.jsx)(n.td,{children:"Within 30-day trial"}),(0,s.jsx)(n.td,{children:"Trial banner with days remaining"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"active"})}),(0,s.jsx)(n.td,{children:"Paid and current"}),(0,s.jsx)(n.td,{children:"Normal access"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"past_due"})}),(0,s.jsx)(n.td,{children:"Payment failed, in grace period"}),(0,s.jsx)(n.td,{children:"Payment failure banner with update card CTA"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"canceled"})}),(0,s.jsx)(n.td,{children:"Subscription ended"}),(0,s.jsx)(n.td,{children:"Subscription ended screen"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"gracePeriod"})," and ",(0,s.jsx)(n.code,{children:"accessRevoked"})," fields in ",(0,s.jsx)(n.code,{children:"/payment/subscription-status"})," indicate whether the user is in a recovery window or has had access fully revoked after non-payment."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"displaying-card-brand",children:"Displaying Card Brand"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"brand"})," field returned by the API is a lowercase string from Stripe. Map it to display names:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'const CARD_BRAND_LABELS: Record<string, string> = {\n  visa: "Visa",\n  mastercard: "Mastercard",\n  amex: "American Express",\n  discover: "Discover",\n  jcb: "JCB",\n  unionpay: "UnionPay",\n  diners: "Diners Club",\n  unknown: "Card",\n};\n\nfunction formatBrand(brand: string): string {\n  return CARD_BRAND_LABELS[brand.toLowerCase()] ?? brand;\n}\n\nfunction formatExpiry(month: number, year: number): string {\n  return `${String(month).padStart(2, "0")}/${String(year).slice(-2)}`;\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.p,{children:"All backend endpoints return standard NestJS error shapes on failure:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "statusCode": 400,\n  "message": "No default payment method found",\n  "error": "Bad Request"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Stripe Elements errors come back on the ",(0,s.jsx)(n.code,{children:"error"})," object from ",(0,s.jsx)(n.code,{children:"confirmCardSetup"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'const { error } = await stripe.confirmCardSetup(...);\nif (error) {\n  // error.message is user-safe (e.g. "Your card was declined.")\n  // error.type gives the category: "card_error" | "validation_error" | etc.\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Common Stripe error types to handle:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"error.type"})}),(0,s.jsx)(n.th,{children:"Cause"}),(0,s.jsx)(n.th,{children:"Suggested UX"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"card_error"})}),(0,s.jsx)(n.td,{children:"Card declined, insufficient funds, expired"}),(0,s.jsxs)(n.td,{children:["Show ",(0,s.jsx)(n.code,{children:"error.message"})," inline"]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"validation_error"})}),(0,s.jsx)(n.td,{children:"Incomplete card number / CVC"}),(0,s.jsx)(n.td,{children:"Show inline, usually pre-validated by Elements"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"api_error"})}),(0,s.jsx)(n.td,{children:"Stripe-side issue"}),(0,s.jsx)(n.td,{children:'Generic "please try again" message'})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"reference-complete-flow-diagram",children:"Reference: Complete Flow Diagram"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'NEW USER TRIAL SETUP\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nUser selects plan\n        \u2502\n        \u25bc\nPOST /auth/setup/trial\n        \u2502 returns clientSecret\n        \u25bc\nstripe.confirmCardSetup(clientSecret, { card })\n        \u2502 returns paymentMethodId\n        \u25bc\nPOST /auth/payment/attach { payment_method_id }\n        \u2502 attaches card + creates trial subscription\n        \u25bc\nShow success (trial active)\n\n\nEXISTING USER \u2014 CARD UPDATE\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nUser clicks "Change card"\n        \u2502\n        \u25bc\nPOST /payment/create-setup-intent\n        \u2502 returns clientSecret\n        \u25bc\nstripe.confirmCardSetup(clientSecret, { card })\n        \u2502 returns paymentMethodId\n        \u25bc\nPOST /payment/update-payment-method { payment_method_id }\n        \u2502 updates card + subscription default, no subscription changes\n        \u25bc\nShow updated card details\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"reference-component",children:"Reference Component"}),"\n",(0,s.jsx)(n.p,{children:"A working reference implementation of both flows is available at:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"docs/TrialSetup.tsx\n"})}),"\n",(0,s.jsx)(n.p,{children:"It handles loading state, error display, the plan selector, initial card collection, and the card update flow with cancel support."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>a});var r=t(6540);const s={},i=r.createContext(s);function d(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);